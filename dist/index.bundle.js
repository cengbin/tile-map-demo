(()=>{"use strict";const t=JSON.parse('{"dt":0,"nu":500,"Cq":500,"No":100,"_A":50,"GJ":[[1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1],[1,1,1,1,0,0,1,1,1,1],[1,1,0,0,0,0,1,1,1,1],[1,1,0,0,0,0,0,1,1,1],[1,0,0,0,0,0,1,1,1,1],[1,0,0,0,0,0,0,1,1,1],[1,0,0,0,0,0,0,1,1,1],[1,0,0,0,1,1,0,0,1,1],[0,0,0,1,1,1,0,0,1,1],[1,0,0,1,1,1,1,0,0,0],[0,0,0,1,1,1,1,0,0,0],[1,0,0,1,1,1,1,1,0,0],[1,0,0,1,1,1,1,1,0,0],[1,0,0,1,1,1,1,1,0,0],[0,0,0,1,1,1,1,1,0,0],[0,0,0,1,1,1,1,1,1,0],[0,0,0,1,1,1,1,1,0,0],[0,0,0,1,1,1,1,1,0,0],[0,0,0,1,1,1,1,1,0,0],[0,0,0,0,1,1,1,1,0,0],[0,0,0,0,1,1,1,1,0,0],[0,0,0,0,1,1,1,1,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0]]}');var e=document.documentElement.clientWidth||document.body.clientWidth,o=document.documentElement.clientHeight||document.body.clientHeight,n=2400,i=1710,r=t.No,s=t._A,a=240,c=171;const h=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=0,this.y=0,this.x=t,this.y=e},l=function(){function t(){this._value=0,this._f=0,this._g=0,this._h=0,this._parent=null,this.ele=null}return t.prototype.toString2=function(){return"路点世界坐标：（"+this._cx+","+this._cy+"),  "+" g=".concat(this.g)+" h=".concat(this.h)+" f=".concat(this.f)},t.prototype.toString=function(){return"路点像素坐标：（"+this._px+","+this._py+"),  路点世界坐标：（"+this._cx+","+this._cy+"),  路点平面直角坐标：（"+this._dx+","+this._dy+")"},Object.defineProperty(t.prototype,"px",{get:function(){return this._px},set:function(t){this._px=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"py",{get:function(){return this._py},set:function(t){this._py=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cx",{get:function(){return this._cx},set:function(t){this._cx=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cy",{get:function(){return this._cy},set:function(t){this._cy=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dx",{get:function(){return this._dx},set:function(t){this._dx=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dy",{get:function(){return this._dy},set:function(t){this._dy=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){return this._value},set:function(t){this._value=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"f",{get:function(){return this._f},set:function(t){this._f=t,this.ele&&this.ele.resetText()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"g",{get:function(){return this._g},set:function(t){this._g=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"h",{get:function(){return this._h},set:function(t){this._h=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return this._parent},set:function(t){this._parent=t},enumerable:!1,configurable:!0}),t}();var u;!function(t){t[t.angle45=0]="angle45",t[t.angle90=1]="angle90",t[t.honeycomb=2]="honeycomb"}(u||(u={}));var p=function(){function t(){}return Object.defineProperty(t,"instance",{get:function(){return null==this._instance&&(this._instance=new t),this._instance},enumerable:!1,configurable:!0}),t.prototype.updateMapInfo=function(t,e,o,n,i){this._mapWidth=t,this._mapHeight=e,this._nodeWidth=o,this._nodeHeight=n,this._halfNodeWidth=Math.floor(this._nodeWidth/2),this._halfNodeHeight=Math.floor(this._nodeHeight/2),this._col=Math.ceil(t/this._nodeWidth),this._row=Math.ceil(e/this._nodeHeight),this._mapType=i,this._mapType===u.angle45&&(this._mapRoad=new f(this._row,this._col,this._nodeWidth,this._nodeHeight,this._halfNodeWidth,this._halfNodeHeight))},t.prototype.getNodeByPixel=function(t,e){return this._mapRoad?this._mapRoad.getNodeByPixel(t,e):new l},t.prototype.getNodeByDerect=function(t,e){return this._mapRoad?this._mapRoad.getNodeByDerect(t,e):new l},t.prototype.getNodeByWorldPoint=function(t,e){return this._mapRoad?this._mapRoad.getNodeByWorldPoint(t,e):new l},t.prototype.getWorldPointByPixel=function(t,e){return this._mapRoad?this._mapRoad.getWorldPointByPixel(t,e):new h},t.prototype.getPixelByWorldPoint=function(t,e){return this._mapRoad?this._mapRoad.getPixelByWorldPoint(t,e):new h},t.prototype.getDerectByPixel=function(t,e){return this._mapRoad?this._mapRoad.getDerectByPixel(t,e):new h},t.prototype.getDerectByWorldPoint=function(t,e){return this._mapRoad?this._mapRoad.getDerectByWorldPoint(t,e):new h},t.prototype.getPixelByDerect=function(t,e){return this._mapRoad?this._mapRoad.getPixelByDerect(t,e):new h},Object.defineProperty(t.prototype,"mapWidth",{get:function(){return this._mapWidth},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mapHeight",{get:function(){return this._mapHeight},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"nodeWidth",{get:function(){return this._nodeWidth},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"nodeHeight",{get:function(){return this._nodeHeight},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"row",{get:function(){return this._row},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"col",{get:function(){return this._col},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"halfNodeWidth",{get:function(){return this._halfNodeWidth},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"halfNodeHeight",{get:function(){return this._halfNodeHeight},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mapType",{get:function(){return this._mapType},enumerable:!1,configurable:!0}),t}();const d=p;var f=function(){function t(t,e,o,n,i,r){this._row=t,this._col=e,this._nodeWidth=o,this._nodeHeight=n,this._halfNodeWidth=i,this._halfNodeHeight=r}return t.prototype.getNodeByPixel=function(t,e){var o=this.getWorldPointByPixel(t,e),n=this.getPixelByWorldPoint(o.x,o.y),i=this.getDerectByPixel(t,e),r=new l;return r.cx=o.x,r.cy=o.y,r.px=n.x,r.py=n.y,r.dx=i.x,r.dy=i.y,r},t.prototype.getNodeByDerect=function(t,e){var o=this.getPixelByDerect(t,e),n=this.getWorldPointByPixel(o.x,o.y),i=new l;return i.cx=n.x,i.cy=n.y,i.px=o.x,i.py=o.y,i.dx=t,i.dy=e,i},t.prototype.getNodeByWorldPoint=function(t,e){var o=this.getPixelByWorldPoint(t,e);return this.getNodeByPixel(o.x,o.y)},t.prototype.getWorldPointByPixel=function(t,e){var o=Math.ceil(t/this._nodeWidth-.5+e/this._nodeHeight)-1,n=this._col-1-Math.ceil(t/this._nodeWidth-.5-e/this._nodeHeight);return new h(o,n)},t.prototype.getPixelByWorldPoint=function(t,e){var o=Math.floor((t+1-(e-(this._col-1)))*this._halfNodeWidth),n=Math.floor((t+1+(e-(this._col-1)))*this._halfNodeHeight);return new h(o,n)},t.prototype.getDerectByPixel=function(t,e){var o=this.getWorldPointByPixel(t,e),n=this.getPixelByWorldPoint(o.x,o.y),i=Math.floor(n.x/this._nodeWidth)-(n.x%this._nodeWidth==0?1:0),r=Math.floor(n.y/this._halfNodeHeight)-1;return new h(i,r)},t.prototype.getDerectByWorldPoint=function(t,e){var o=Math.floor((t-(e-(this._col-1)))/2),n=t+(e-(this._col-1));return new h(o,n)},t.prototype.getPixelByDerect=function(t,e){var o=Math.floor((t+e%2)*this._nodeWidth+(1-e%2)*this._halfNodeWidth),n=Math.floor((e+1)*this._halfNodeHeight);return new h(o,n)},t}();const y=function(){function t(t){this.COST_STRAIGHT=10,this.COST_DIAGONAL=14,this.maxStep=1e3,this._round=[[0,-1,10],[1,-1,14],[1,0,10],[1,1,14],[0,1,10],[-1,1,14],[-1,0,10],[-1,-1,14]],this.handle=-1,this.optimize=!0,this._roadNodes=t}return t.prototype.resetText=function(){for(var t in this._roadNodes){var e=this._roadNodes[t];e.ele&&e.ele.htxt&&(e.ele.htxt.visible=!1)}},t.prototype.seekPath=function(t,e){if(this._startNode=t,this._currentNode=t,this._targetNode=e,!this._startNode||!this._targetNode)return[];if(console.log("from: ".concat(t.cx,",").concat(t.cy)," to: ".concat(e.cx,",").concat(e.cy)),1===this._targetNode.value)return console.log("目标不可达到："),[];this._openlist=[],this._closelist=[];for(var o=0;;){if(o>this.maxStep)return console.log("没找到目标计算步骤为：",o),[];if(o++,this.searchRoundNodes(this._currentNode),0==this._openlist.length)return console.log("没找到目标计算步骤为：",o),[];if(this._openlist.sort(this.sortNode),this._currentNode=this._openlist.shift(),this._currentNode==this._targetNode)return console.log("找到目标计算步骤为：",o),this.getPath();this._closelist.push(this._currentNode)}return[]},t.prototype.seekPath2=function(t,e){if(this._startNode=t,this._currentNode=t,this._targetNode=e,!this._startNode||!this._targetNode)return[];console.log("from:(".concat(t.cx,",").concat(t.cy,")")," to:(".concat(e.cx,",").concat(e.cy,")")),this.resetText(),this._openlist=[],this._closelist=[];for(var o=0,n=null;;){if(o>this.maxStep)return console.log("没找到目标计算步骤为：",o),this.seekPath(t,n);if(o++,this.searchRoundNodes(this._currentNode),0==this._openlist.length)return console.log("没找到目标计算步骤为：",o),this.seekPath(t,n);if(this._openlist.sort(this.sortNode),this._currentNode=this._openlist.shift(),(null==n||this._currentNode.h<n.h)&&(n=this._currentNode),this._currentNode==this._targetNode)return console.log("找到目标计算步骤为：",o),this.getPath();this._closelist.push(this._currentNode)}return this.seekPath(t,n)},t.prototype.sortNode=function(t,e){return t.f<e.f?-1:t.f>e.f?1:0},t.prototype.getPath=function(){for(var t=[],e=this._targetNode;e!=this._startNode;)t.unshift(e),e=e.parent;if(t.unshift(this._startNode),!this.optimize)return t;for(var o=1;o<t.length-1;o++){var n=t[o-1],i=t[o],r=t[o+1],s=i.cx==n.cx&&i.cx==r.cx,a=i.cy==n.cy&&i.cy==r.cy,c=(i.cx-n.cx)/(i.cy-n.cy)*((r.cx-i.cx)/(r.cy-i.cy))==1;(s||a||c)&&(t.splice(o,1),o--)}for(o=0;o<t.length-2;o++){for(var h=t[o],l=null,u=t.length-1;u>o+1;u--){var p=t[u];if(h.cx!=p.cx&&h.cy!=p.cy&&Math.abs(p.cx-h.cx)!=Math.abs(p.cy-h.cy)&&this.isArriveBetweenTwoNodes(h,p)){l=p;break}}if(l){var d=u-o-1;t.splice(o+1,d)}}return t},t.prototype.isArriveBetweenTwoNodes=function(t,e){if(t==e)return!1;var o=Math.abs(e.cx-t.cx),n=Math.abs(e.cy-t.cy),i=0;e.cx>t.cx?i=1:e.cx<t.cx&&(i=-1);var r=0;e.cy>t.cy?r=1:e.cy<t.cy&&(r=-1);var s=0,a=0,c=0,h=0;if(o>n)for(var l=n/o,u=0;u<o;u++){a=t.cy+u*r*l,c=Math.floor(a),h=a%1;var p=t.cx+u*i,d=h<=.5?c:c+1;a=t.cy+(u+1)*r*l,c=Math.floor(a),h=a%1;var f=t.cx+(u+1)*i,y=h<=.5?c:c+1,_=this._roadNodes[p+"_"+d],g=this._roadNodes[f+"_"+y];if(!this.isCrossAtAdjacentNodes(_,g))return!1}else for(l=o/n,u=0;u<n;u++)if(s=u*i*l,c=i>0?Math.floor(t.cx+s):Math.ceil(t.cx+s),p=(h=Math.abs(s%1))<=.5?c:c+1*i,d=t.cy+u*r,s=(u+1)*i*l,c=i>0?Math.floor(t.cx+s):Math.ceil(t.cx+s),f=(h=Math.abs(s%1))<=.5?c:c+1*i,y=t.cy+(u+1)*r,_=this._roadNodes[p+"_"+d],g=this._roadNodes[f+"_"+y],!this.isCrossAtAdjacentNodes(_,g))return!1;return!0},t.prototype.isCrossAtAdjacentNodes=function(t,e){if(t==e)return!1;if(!this.isPassNode(t)||!this.isPassNode(e))return!1;var o=e.cx-t.cx,n=e.cy-t.cy;return!(Math.abs(o)>1||Math.abs(n)>1||t.cx!=e.cx&&t.cy!=e.cy&&(!this.isPassNode(this._roadNodes[t.cx+"_"+(t.cy+n)])||!this.isPassNode(this._roadNodes[t.cx+o+"_"+t.cy])))},t.prototype.isPassNode=function(t){return!(!t||1==t.value)},t.prototype.testSeekPathStep=function(t,e,o,n,i){var r=this;if(void 0===i&&(i=100),this._startNode=t,this._currentNode=t,this._targetNode=e,1!=this._targetNode.value){this._openlist=[],this._closelist=[];var s=0;clearInterval(this.handle),this.handle=setInterval((function(){return s>r.maxStep?(console.log("没找到目标计算步骤为：",s),void clearInterval(r.handle)):(s++,r.searchRoundNodes(r._currentNode),0==r._openlist.length?(console.log("没找到目标计算步骤为：",s),void clearInterval(r.handle)):(r._openlist.sort(r.sortNode),r._currentNode=r._openlist.shift(),void(r._currentNode==r._targetNode?(console.log("找到目标计算步骤为：",s),clearInterval(r.handle),o.apply(n,[r._startNode,r._targetNode,r._currentNode,r._openlist,r._closelist,r.getPath()])):(r._closelist.push(r._currentNode),o.apply(n,[r._startNode,r._targetNode,r._currentNode,r._openlist,r._closelist,null])))))}),i)}},t.prototype.searchRoundNodes=function(t){var e=this;this._round.forEach((function(o,n){var i=o[0],r=o[1],s=(o[2],t.cx+i),a=t.cy+r,c=e._roadNodes[s+"_"+a];null==c||c==e._startNode||1===c.value||e.isInCloseList(c)||e.isInCorner(c)||e.setNodeF(c)}))},t.prototype.setNodeF=function(t){var e;if(e=t.cx==this._currentNode.cx||t.cy==this._currentNode.cy?this._currentNode.g+this.COST_STRAIGHT:this._currentNode.g+this.COST_DIAGONAL,this.isInOpenList(t)){if(!(e<t.g))return;t.g=e}else t.g=e,this._openlist.push(t);t.h=(Math.abs(this._targetNode.cx-t.cx)+Math.abs(this._targetNode.cy-t.cy))*this.COST_STRAIGHT,t.f=t.g+t.h,t.parent=this._currentNode},t.prototype.isInOpenList=function(t){return-1!=this._openlist.indexOf(t)},t.prototype.isInCloseList=function(t){return-1!=this._closelist.indexOf(t)},t.prototype.isInCorner=function(t){if(t.cx==this._currentNode.cx||t.cy==this._currentNode.cy)return!1;var e=this._roadNodes[this._currentNode.cx+"_"+t.cy],o=this._roadNodes[t.cx+"_"+this._currentNode.cy];return!this.isPassNode(e)||!this.isPassNode(o)},t.prototype.dispose=function(){this._roadNodes=null,this._round=null},t}();var _,g=(_=function(t,e){return _=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},_(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=t}_(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});const x=function(t){function e(){for(var e=t.call(this)||this,o=[],n=1;n<=64;n++){var i=PIXI.Texture.from("Explosion_Sequence_A ".concat(n,".png"));o.push(i)}var r=e.player=new PIXI.AnimatedSprite(o);r.onFrameChange=function(){var t=r.currentFrame;(t>e.endFrame||56===e.startFrame&&0===t)&&r.gotoAndPlay(e.startFrame)},r.x=0,r.y=0,r.anchor.set(.5,.65625),r.gotoAndStop(49),r.animationSpeed=.2,e.addChild(r);var s=new PIXI.Graphics;return s.beginFill(14561865),s.drawRect(0,0,5,5),s.endFill(),e.addChild(s),e}return g(e,t),e.prototype.setPosition=function(t,e){this.x=t,this.y=e},e.prototype.play=function(t){(t=(t+360)%360)<=202.5&&t>157.5?(this.startFrame=0,this.endFrame=7):t<=247.5&&t>202.5?(this.startFrame=8,this.endFrame=15):t<=292.5&&t>247.5?(this.startFrame=16,this.endFrame=23):t<=337.5&&t>292.5?(this.startFrame=24,this.endFrame=31):t<=22.5||t>337.5?(this.startFrame=32,this.endFrame=39):t<=67.5&&t>22.5?(this.startFrame=40,this.endFrame=47):t<=112.5&&t>67.5?(this.startFrame=48,this.endFrame=55):t<=157.5&&t>112.5&&(this.startFrame=56,this.endFrame=63),this.player.gotoAndPlay(this.startFrame)},e.prototype.stop=function(){this.player.gotoAndStop(this.startFrame)},e}(PIXI.Container);var m=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();const v=function(t){function r(){var e=t.call(this)||this;e.mapPieceStatus=[];var o=null;e.interactive=!0,e.on("pointerdown",(function(t){o={x:t.data.global.x,y:t.data.global.y}})),e.on("pointerup",(function(t){if(o){var n=o.x,i=o.y,r={x:t.data.global.x,y:t.data.global.y},s=r.x,a=r.y;Math.sqrt((s-n)*(s-n)+(a-i)*(a-i))<1&&e.emit("click_map",t.data.getLocalPosition(e.parent))}o=null}));var r=PIXI.Sprite.from("./static/assets/s2/s2_min.jpg");e.addChildAt(r,0),r.scale.set(n/r.texture.width,i/r.texture.height),e.mapPieceStatus=[];for(var s=0;s<10;s++){e.mapPieceStatus[s]=[];for(var h=0;h<10;h++){e.mapPieceStatus[s][h]=0;var l=new PIXI.Graphics;l.lineStyle(1,16777215,1),l.moveTo(0,0),l.lineTo(a,0),l.lineTo(a,c),l.lineTo(0,c),l.closePath(),l.endFill(),e.addChild(l),l.position.set(h*a,s*c);var u=new PIXI.Text("".concat(s,"/").concat(h),{fontSize:12,fill:16777215,align:"center"});e.addChild(u),u.position.set(h*a,s*c)}}return e}return m(r,t),r.prototype.update=function(){for(var t=this.parent,n=t.x,i=t.y,r=Math.ceil(o/c),s=Math.ceil(e/a),h=parseInt(Math.abs(i)/c),l=parseInt(Math.abs(n)/a),u=0;u<r;u++)for(var p=0;p<s;p++){var d=h+u,f=l+p;this.mapPieceStatus[d][f]||(this.mapPieceStatus[d][f]=1,this.load(d,f))}},r.prototype.load=function(t,e){var o=this,n="./static/assets/s2/240*171/s2_".concat(t,"_").concat(e,".jpg"),i=new PIXI.Loader;i.add(n),i.once("complete",(function(){var i=a*e,r=c*t,s=new PIXI.Sprite.from(n);o.addChildAt(s,1),s.position.set(i,r)})),i.load()},r.prototype.drawNode=function(t){var e=new b(t);this.addChild(e),t.ele=e},r}(PIXI.Container);var b=function(t){function e(e){var o=t.call(this)||this;o.node=e,e.cx,e.cy;var n=e.dx,i=e.dy,r=e.px,s=e.py,a=e.value;o.x=r,o.y=s,o.bg=new PIXI.Graphics,o.addChild(o.bg),o.setBGColor(0===a?32768:16711680,0===a?0:.1);var c=new PIXI.Text("".concat(n,"/").concat(i),{fontSize:12,fill:16777215,align:"center"});return o.addChild(c),c.anchor.set(.5,.5),c.x=0,c.y=0,c.angle=26.56505117707799,o}return m(e,t),e.prototype.resetText=function(){this.htxt&&(this.htxt.visible=!0),this.htxt&&(this.htxt.text="".concat(this.node.g,",").concat(this.node.h,",").concat(this.node.f))},e.prototype.setBGColor=function(t,e){var o=r,n=s,i=this.bg;return i.clear(),i.beginFill(t,e),i.lineStyle(1,16777215,.3),i.moveTo(-o/2,0),i.lineTo(0,-n/2),i.lineTo(o/2,0),i.lineTo(0,n/2),i.closePath(),i.endFill(),this},e.prototype.resetBg=function(){var t=this.node.value;this.setBGColor(0===t?32768:16711680,0===t?0:.3)},e}(PIXI.Container),P=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();const N=function(e){function o(){var o=e.call(this)||this;o._roadDic={},o.roadNodeArr=[],o.sceneMap=new v,o.addChild(o.sceneMap),o.sceneMap.on("click_map",(function(t){o.startNode&&o.startNode.resetBg(),o.targetNode&&o.targetNode.resetBg(),console.log("click map",t);var e=t.x,n=t.y,i=d.instance.getWorldPointByPixel(o.player.x,o.player.y),r=d.instance.getWorldPointByPixel(e,n),s=o._roadDic[i.x+"_"+i.y],a=o._roadDic[r.x+"_"+r.y];console.log(s,a);var c=o._roadSeeker.seekPath2(s,a);console.log(c),c.length>=2&&(o.startNode=c[0].ele.setBGColor(0,.5),o.targetNode=c[c.length-1].ele.setBGColor(16777215,.5));var h=window.TweenMax.getTweensOf(o.player);h&&h.length&&h[0].kill(),o.roadNodeArr=c,o.move()})),o.player=new x,o.addChild(o.player),d.instance.updateMapInfo(t.nu,t.Cq,t.No,t._A,t.dt);for(var n=0;n<t.GJ.length;n++)for(var i=0;i<t.GJ[0].length;i++)(r=d.instance.getNodeByDerect(i,n)).value=t.GJ[n][i],o._roadDic[r.cx+"_"+r.cy]=r,n<200&&i<200&&o.sceneMap.drawNode(r);o._roadSeeker=new y(o._roadDic);var r=d.instance.getNodeByDerect(4,9);return o.player.setPosition(r.px,r.py),o}return P(o,e),o.prototype.move=function(){if(this.roadNodeArr&&this.roadNodeArr.length>0){var t=this.roadNodeArr.shift();console.log(t.toString());var e=t.px-this.player.x,o=t.py-this.player.y,n=180/Math.PI*Math.atan2(o,e);this.player.play(n);var i=Math.sqrt(e*e+o*o),r=Math.abs(i)/100*1;window.TweenMax.to(this.player,r,{x:t.px,y:t.py,ease:window.Power0.easeNone,onComplete:this.move.bind(this)})}else this.player.stop()},o}(PIXI.Container);var w=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();const O=function(t){function e(e){var o=t.call(this)||this;o.$config=Object.assign({},e);var n=new PIXI.Sprite.from("./static/assets/minus.png");o.addChild(n),n.scale.set(.5),n.buttonMode=!0,n.interactive=!0,n.on("pointerdown",(function(t){o.ratio-=.1,o.$config.update&&o.$config.update(o._ratio),t.stopPropagation()}));var i=new PIXI.Text("",{fontFamily:"Arial",fontSize:16,fill:16777215,align:"center"});i.anchor.set(.5),o.addChild(i),i.x=52.5,i.y=12.5,o.text=i;var r=new PIXI.Sprite.from("./static/assets/plus.png");return o.addChild(r),r.scale.set(.5),r.buttonMode=!0,r.x=80,r.interactive=!0,r.on("pointerdown",(function(t){o.ratio+=.1,o.$config.update&&o.$config.update(o._ratio),t.stopPropagation()})),o.ratio=o.$config.ratio||1,o}return w(e,t),Object.defineProperty(e.prototype,"ratio",{get:function(){return this._ratio},set:function(t){t<=this.$config.minScale?t=this.$config.minScale:t>=this.$config.maxScale&&(t=this.$config.maxScale),this._ratio=t,this.text.text=parseInt(100*this._ratio)+"%"},enumerable:!1,configurable:!0}),e}(PIXI.Container);var M=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();const I=function(t){function r(e){void 0===e&&(e={});var o=t.call(this,e)||this;document.body.prepend(o.view);var n=new PIXI.Loader;return n.add("spritesheet","./static/assets/mc.json"),n.add(["./static/assets/s2/s2_min.jpg"]),n.once("complete",(function(){o.init()})),n.load(),o}return M(r,t),r.prototype.init=function(){return t=this,r=void 0,a=function(){var t,r,s,a,c;return function(t,e){var o,n,i,r,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){return function(r){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,n&&(i=2&r[0]?n.return:r[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,r[1])).done)return i;switch(n=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,n=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==r[0]&&2!==r[0])){s=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){s.label=r[1];break}if(6===r[0]&&s.label<i[1]){s.label=i[1],i=r;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(r);break}i[2]&&s.ops.pop(),s.trys.pop();continue}r=e.call(t,s)}catch(t){r=[6,t],n=0}finally{o=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}}(this,(function(h){return t=Math.max(e/n,o/i),r=new N,this.stage.addChild(r),r.scale.set(1),s=new O({ratio:r.scale.x,minScale:t,maxScale:2,update:function(t){var r=c.value;c.value=t,c.calculatePosition(r,c.value,e/2,o/2),a.contentWidth=n*t,a.contentHeight=i*t}}),this.stage.addChild(s),s.x=e-120,s.y=10,new S({ele:r,width:n,height:i,update:function(){r.sceneMap.update()}}),a=new W({content:r,maskWidth:e,maskHeight:o,contentWidth:2400,contentHeight:1710}),c=new j({ele:r,value:1,minZoom:t,maxZoom:2,update:function(t){s.ratio=t,a.contentWidth=n*t,a.contentHeight=i*t}}),r.sceneMap.update(),[2]}))},new((s=void 0)||(s=Promise))((function(e,o){function n(t){try{c(a.next(t))}catch(t){o(t)}}function i(t){try{c(a.throw(t))}catch(t){o(t)}}function c(t){var o;t.done?e(t.value):(o=t.value,o instanceof s?o:new s((function(t){t(o)}))).then(n,i)}c((a=a.apply(t,r||[])).next())}));var t,r,s,a},r}(PIXI.Application);var S=function(){function t(t){var e=(this.options=t).ele;this.ele=e,this.ele.interactive=!0,this.ele.on("pointerdown",this.onDragStart,this)}return t.prototype.onDragStart=function(t){var e=t.data.global,o=e.x,n=e.y;this.dragging=!0,this.offset={x:this.ele.x-o,y:this.ele.y-n},this.ele.on("pointerup",this.onDragEnd,this),this.ele.on("pointerupoutside",this.onDragEnd,this),this.ele.on("pointermove",this.onDragMove,this)},t.prototype.onDragEnd=function(){this.dragging=!1,this.offset=null,this.ele.off("pointerup",this.onDragEnd,this).off("pointerupoutside",this.onDragEnd,this).off("pointermove",this.onDragMove,this)},t.prototype.onDragMove=function(t){if(this.dragging){var r=t.data.global,s=r.x,a=r.y,c=s+this.offset.x;c=c>=0?0:c<=-(n*this.ele.scale.x-e)?-(n*this.ele.scale.x-e):c;var h=a+this.offset.y;h=h>=0?0:h<=-(i*this.ele.scale.y-o)?-(i*this.ele.scale.y-o):h,this.ele.x=c,this.ele.y=h,this.options.update&&this.options.update()}},t}(),W=function(){function t(t){var e=this._options=t,o=e.content,n=e.maskWidth,i=e.maskHeight,r=e.contentWidth,s=e.contentHeight;this._content=o,this._maskWidth=n,this._maskHeight=i,this._contentWidth=r,this._contentHeight=s,this._deceleration=.001,this._content.on("pointerdown",this.onPointerDownListener,this)}return t.prototype.onPointerDownListener=function(){var t=window.TweenMax.getTweensOf(this._content);t.length&&t[0].kill(),this._start={time:(new Date).getTime(),x:this._content.x,y:this._content.y},this._content.on("pointerup",this.onPointerUpListener,this),this._content.on("pointerout",this.onPointerOutListener,this)},t.prototype.onPointerUpListener=function(){if(this._start){var t=(new Date).getTime()-this._start.time,e=this.momentum(this._content.x,this._start.x,t,this.maxScrollLeft,0,this._deceleration),o=this.momentum(this._content.y,this._start.y,t,this.maxScrollTop,0,this._deceleration),n=e.destination,i=o.destination,r=Math.max(e.duration,o.duration),s={x:n,y:i,ease:window.Power2.easeOut,onUpdate:function(){},onComplete:function(){}};window.TweenMax.to(this._content,r/1e3,s)}this._content.off("pointerup",this.onPointerUpListener,this),this._content.off("pointerout",this.onPointerOutListener,this)},t.prototype.onPointerOutListener=function(){this.onPointerUpListener()},t.prototype.momentum=function(t,e,o,n,i,r){void 0===r&&(r=6e-4);var s,a,c,h=t-e,l=Math.abs(h)/o;return a=l/r,(s=t+(l*(c=(0-l)/r)+.5*r*c*c)*(h>0?-1:1))<n?(s=i?n-i/2.5*(l/8):n,a=(h=Math.abs(s-t))/l):s>0&&(s=i?i/2.5*(l/8):0,a=(h=Math.abs(t)+s)/l),{destination:Math.round(s),duration:a}},Object.defineProperty(t.prototype,"contentWidth",{set:function(t){this._contentWidth=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"contentHeight",{set:function(t){this._contentHeight=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxScrollLeft",{get:function(){return this._maskWidth-this._contentWidth},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxScrollTop",{get:function(){return this._maskHeight-this._contentHeight},enumerable:!1,configurable:!0}),t}(),j=function(){function t(e){var o=this.$config=Object.assign({},t.defaultConfig,e),n=o.ele,i=o.value;this.ele=n,this.value=i,this.onMouseWheel=this.onMouseWheel.bind(this),document.addEventListener("mousewheel",this.onMouseWheel,{passive:!1})}return t.prototype.onMouseWheel=function(t){this.zoom(t),t.preventDefault()},t.prototype.zoom=function(t){var e=this.$config,o=e.speed,n=e.minZoom,i=e.maxZoom,r=this.value,s=t.wheelDelta<=0?r-o:r+o;s>=i?s=i:s<=n&&(s=n),this.value=s,this.$config.update&&this.$config.update(this.value),this.calculatePosition(r,s,t.clientX,t.clientY)},t.prototype.calculatePosition=function(t,e,o,n){var i=e/t;this.x*=i,this.y*=i,this.x-=(i-1)*o,this.y-=(i-1)*n},Object.defineProperty(t.prototype,"value",{get:function(){return this.ele.scale.x},set:function(t){t=t>this.$config.maxZoom?this.$config.maxZoom:t<this.$config.minZoom?this.$config.minZoom:t,this.ele.scale.set(t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"x",{get:function(){return this.ele.x},set:function(t){t=t>=0?0:t<=-(n*this.value-e)?-(n*this.value-e):t,this.ele.x=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this.ele.y},set:function(t){t=t>=0?0:t<=-(i*this.value-o)?-(i*this.value-o):t,this.ele.y=t},enumerable:!1,configurable:!0}),t.prototype.destroy=function(){document.removeEventListener("mousewheel",this.onMouseWheel)},t.defaultConfig={x:0,y:0,value:1,speed:.2,minScale:.5,maxScale:2},t}();new I({width:e,height:o,backgroundColor:13421772})})();